<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Halaman Guru</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        :root {
            --sidebar-width: 250px;
            --header-height: 60px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
        }

        .sidebar {
            width: var(--sidebar-width);
            background-color: #34495e;
            position: fixed;
            top: 0;
            left: 0;
            height: 100%;
            padding: 20px;
            color: white;
            transition: transform 0.3s ease;
            transform: translateX(0);
            z-index: 1000;
            display: flex;
            flex-direction: column;
        }

        .sidebar.collapsed {
            transform: translateX(calc(-1 * var(--sidebar-width)));
        }

        .sidebar-menu {
            list-style: none;
            padding: 0;
            margin-top: 20px;
        }

        .sidebar-menu li {
            margin-bottom: 10px;
        }

        .sidebar-menu a {
            color: white;
            text-decoration: none;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }

        .sidebar-menu a:hover, .sidebar-menu a.active {
            background-color: #4a627a;
        }

        .sidebar-menu a i {
            margin-right: 10px;
        }

        .header {
            height: var(--header-height);
            background-color: #2c3e50;
            color: white;
            display: flex;
            align-items: center;
            padding: 0 20px;
            position: fixed;
            top: 0;
            left: var(--sidebar-width);
            width: calc(100% - var(--sidebar-width));
            z-index: 999;
            transition: left 0.3s ease, width 0.3s ease;
        }

        .header.shifted {
            left: 0;
            width: 100%;
        }

        .toggle-btn {
            font-size: 24px;
            cursor: pointer;
            margin-right: 20px;
        }

        .content {
            padding: calc(var(--header-height) + 20px) 20px 20px var(--sidebar-width);
            padding-left: calc(var(--sidebar-width) + 20px);
            transition: padding-left 0.3s ease;
        }

        .content.shifted {
            padding-left: 20px;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }
        
        .profile {
            text-align: center;
            padding: 20px 0;
            border-bottom: 1px solid #4a627a;
        }

        .profile-info {
            cursor: pointer;
            padding: 10px;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }

        .profile-info:hover {
            background-color: #4a627a;
        }

        .profile-info img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid white;
            margin-bottom: 10px;
        }

        .profile-info h3 {
            margin: 0;
            font-size: 1.2em;
        }

        .profile-info p {
            margin: 5px 0;
            font-size: 0.9em;
            color: #bdc3c7;
        }
        
        .logout-btn-container {
            margin-top: auto;
            padding-bottom: 20px;
            text-align: center;
        }

        .logout-btn {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .logout-btn:hover {
            background-color: #c0392b;
        }
        
        /* Modal Umum */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: #fff;
            margin: 5% auto;
            padding: 20px;
            border-radius: 10px;
            width: 80%;
            max-width: 500px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-content h3 {
            margin-bottom: 10px;
        }

        .modal-content label {
            display: block;
            margin-top: 10px;
            font-weight: bold;
        }

        .modal-content input,
        .modal-content select,
        .modal-content textarea {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            margin-bottom: 12px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        .image-preview {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 2px dashed #ccc;
            margin: 10px auto;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }
        
        .modal-buttons {
            text-align: right;
            margin-top: 20px;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .modal-buttons button {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .btn-close {
            background-color: #e74c3c;
            color: white;
        }
        
        .btn-save {
            background-color: #2ecc71;
            color: white;
        }
        
        .btn-save:hover {
            background-color: #27ae60;
        }
        
        .btn-edit {
            background-color: #3498db;
            color: white;
        }
        
        .btn-edit:hover {
            background-color: #2980b9;
        }
        
        .gender-group {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .gender-group label {
            display: inline-flex;
            align-items: center;
            font-weight: normal;
        }

        .gender-group input[type="radio"] {
            width: auto;
            margin-right: 5px;
        }

        /* Jadwal Mengajar */
        .schedule-card-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .schedule-card {
            background-color: white;
            border-left: 5px solid #1abc9c;
            border-radius: 5px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .schedule-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .schedule-card h4 {
            font-size: 1.1em;
            color: #34495e;
            margin-bottom: 5px;
        }

        .schedule-card p {
            font-size: 0.9em;
            color: #555;
            margin: 3px 0;
        }

        .schedule-card .time {
            font-weight: bold;
            color: #2980b9;
        }

        /* Absensi */
        .attendance-summary-card {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-top: 20px;
        }

        .attendance-summary-card h4 {
            color: #34495e;
            margin-bottom: 15px;
        }

        .attendance-stats {
            display: flex;
            justify-content: space-around;
            text-align: center;
        }

        .stat-item h5 {
            margin: 0;
            font-size: 2em;
            color: #2c3e50;
        }

        .stat-item p {
            font-size: 0.9em;
            color: #7f8c8d;
        }
        
        .attendance-list-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        .attendance-list-item:last-child {
            border-bottom: none;
        }

        .attendance-list-item .status {
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 15px;
            color: white;
            font-size: 0.9em;
        }

        .status-Sakit { background-color: #f1c40f; color: #333; }
        .status-Izin { background-color: #3498db; }
        .status-Alpha { background-color: #e74c3c; }
        .status-Hadir { background-color: #2ecc71; }
        .status-Pending { background-color: #f39c12; }
        
        .attendance-list-item .actions button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.1em;
            color: #7f8c8d;
            margin-left: 5px;
        }

        .attendance-list-item .actions button.confirm { color: #2ecc71; }
        .attendance-list-item .actions button.reject { color: #e74c3c; }
        .attendance-list-item .actions button.cancel { color: #e67e22; }

        .attendance-list-item .murid-info {
            flex-grow: 1;
        }
        
        .attendance-records-container {
            margin-top: 20px;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(calc(-1 * var(--sidebar-width)));
            }
            .sidebar.collapsed {
                transform: translateX(0);
            }
            .header {
                left: 0;
                width: 100%;
            }
            .content {
                padding-left: 20px;
            }
        }
        
        /* Tampilan Profil Modal BARU */
        .profile-view-image-container {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .profile-view-image-container img {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid #3498db;
        }
        
        .profile-view-data {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .profile-view-item {
            display: flex;
            align-items: center;
        }
        
        .profile-view-item i {
            margin-right: 15px;
            font-size: 1.5em;
            color: #3498db;
        }
        
        .profile-view-item .item-text {
            display: flex;
            flex-direction: column;
        }
        
        .profile-view-item .item-label {
            font-size: 0.8em;
            color: #7f8c8d;
        }
        
        .profile-view-item .item-value {
            font-weight: bold;
            color: #34495e;
        }
    </style>
</head>
<body>

    <div class="sidebar" id="sidebar">
        <div class="profile">
            <div class="profile-info" id="profile-btn" role="button" aria-label="Edit Profil">
                <img src="https://i.pinimg.com/originals/56/23/a3/5623a3007d20657bdd96ff799e6fd814.jpg" alt="Profile" id="profile-img">
                <h3 id="profile-name">Ahmad Syukri</h3>
                <p id="profile-title">Guru Matematika</p>
                <p id="profile-email">ahmad@example.com</p>
            </div>
        </div>
        <ul class="sidebar-menu">
            <li><a href="#" id="jadwal-tab" class="active"><i class="fas fa-calendar-alt"></i>Jadwal Mengajar</a></li>
            <li><a href="#" id="absensi-tab"><i class="fas fa-user-check"></i>Rekap Absensi</a></li>
        </ul>
        <div class="logout-btn-container">
            <button class="logout-btn" id="logout-btn">Logout</button>
        </div>
    </div>

    <div class="header" id="header">
        <i class="fas fa-bars toggle-btn" onclick="toggleSidebar()" role="button" aria-label="Toggle Sidebar"></i>
        <h1 id="page-title">Halaman Guru</h1>
    </div>

    <div class="content" id="mainContent">

        <div id="jadwal-content" class="content-section active">
            <h2>Selamat Datang, <span id="welcome-name">Pak Ahmad</span>!</h2>
            <p>Berikut adalah jadwal mengajar Anda. Klik jadwal untuk melihat daftar absensi murid.</p>
            <div id="schedule-container">
            </div>
        </div>

        <div id="absensi-content" class="content-section">
            <h2>Rekapitulasi Absensi Murid</h2>
            <div class="filter-container">
                <label for="class-filter">Pilih Kelas:</label>
                <select id="class-filter">
                </select>
            </div>
            <div id="attendance-records-container">
                <p>Pilih kelas untuk melihat rekap absensi.</p>
            </div>
        </div>

    </div>

    <div id="guru-view-modal" class="modal">
        <div class="modal-content">
            <h3 style="text-align: center;">Profil Guru</h3>
            <div class="profile-view-image-container">
                <img id="profile-view-img" src="" alt="Foto Profil" />
            </div>
            <div class="profile-view-data">
                <div class="profile-view-item">
                    <i class="fas fa-id-badge"></i>
                    <div class="item-text">
                        <span class="item-label">NIP</span>
                        <span class="item-value" id="profile-view-nip"></span>
                    </div>
                </div>
                <div class="profile-view-item">
                    <i class="fas fa-user"></i>
                    <div class="item-text">
                        <span class="item-label">Nama Lengkap</span>
                        <span class="item-value" id="profile-view-nama"></span>
                    </div>
                </div>
                <div class="profile-view-item">
                    <i class="fas fa-envelope"></i>
                    <div class="item-text">
                        <span class="item-label">Email</span>
                        <span class="item-value" id="profile-view-email"></span>
                    </div>
                </div>
                <div class="profile-view-item">
                    <i class="fas fa-phone"></i>
                    <div class="item-text">
                        <span class="item-label">Nomor HP</span>
                        <span class="item-value" id="profile-view-nohp"></span>
                    </div>
                </div>
                <div class="profile-view-item">
                    <i class="fas fa-book"></i>
                    <div class="item-text">
                        <span class="item-label">Jabatan</span>
                        <span class="item-value" id="profile-view-jabatan"></span>
                    </div>
                </div>
                <div class="profile-view-item">
                    <i class="fas fa-mars-and-venus"></i>
                    <div class="item-text">
                        <span class="item-label">Jenis Kelamin</span>
                        <span class="item-value" id="profile-view-gender"></span>
                    </div>
                </div>
                <div class="profile-view-item">
                    <i class="fas fa-calendar-day"></i>
                    <div class="item-text">
                        <span class="item-label">Tanggal Lahir</span>
                        <span class="item-value" id="profile-view-dob"></span>
                    </div>
                </div>
                <div class="profile-view-item">
                    <i class="fas fa-home"></i>
                    <div class="item-text">
                        <span class="item-label">Alamat</span>
                        <span class="item-value" id="profile-view-alamat"></span>
                    </div>
                </div>
            </div>
            <div class="modal-buttons" style="margin-top: 30px;">
                <button type="button" class="btn-edit" id="btn-edit-profile-from-view">Edit Profil</button>
                <button type="button" class="btn-close" id="btn-close-view">Tutup</button>
            </div>
        </div>
    </div>

    <div id="guru-modal" class="modal">
        <div class="modal-content">
            <h3 id="modal-title">Edit Profil Guru</h3>
            <form id="guru-form">
                <label for="namaGuru">Nama Guru:</label>
                <input type="text" id="namaGuru" required>
                <label for="nipGuru">NIP:</label>
                <input type="text" id="nipGuru" readonly>

                <label>Jenis Kelamin:</label>
                <div class="gender-group">
                    <input type="radio" id="male" name="gender" value="Laki-Laki">
                    <label for="male">Laki-Laki</label>
                    <input type="radio" id="female" name="gender" value="Perempuan">
                    <label for="female">Perempuan</label>
                </div>

                <label for="dobGuru">Tanggal Lahir:</label>
                <input type="date" id="dobGuru">

                <label for="photoGuru">Foto Guru:</label>
                <div class="image-preview" id="photo-preview"></div>
                <input type="file" id="photoGuru" accept="image/*">

                <label for="nohpGuru">Nomor HP:</label>
                <input type="text" id="nohpGuru">
                <label for="emailGuru">Email:</label>
                <input type="email" id="emailGuru">
                <label for="passwordGuru">Password Baru:</label>
                <input type="password" id="passwordGuru" placeholder="Kosongkan jika tidak ingin diubah">
                <label for="alamatGuru">Alamat:</label>
                <input type="text" id="alamatGuru">
                <div class="modal-buttons">
                    <button type="submit" class="btn-save">Simpan</button>
                    <button type="button" class="btn-close" id="btn-cancel">Batal</button>
                </div>
            </form>
        </div>
    </div>

    <div id="attendance-list-modal" class="modal">
        <div class="modal-content">
            <h3 id="attendance-list-modal-title">Daftar Absen</h3>
            <p>Klik tombol untuk mengkonfirmasi atau menolak status absen murid.</p>
            <div id="attendance-list">
            </div>
            <div class="modal-buttons">
                <button type="button" class="btn-close" id="btn-close-absensi">Tutup</button>
            </div>
        </div>
    </div>
    
    <div id="change-status-modal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <h3>Ubah Status Absensi</h3>
            <p>Murid: <strong id="modal-murid-nama"></strong></p>
            <form id="change-status-form">
                <label for="new-status">Pilih Status Baru:</label>
                <select id="new-status" required>
                    <option value="">Pilih...</option>
                    <option value="Hadir">Hadir</option>
                    <option value="Sakit">Sakit</option>
                    <option value="Izin">Izin</option>
                    <option value="Alpha">Alpha</option>
                    <option value="Pending">Pending</option>
                </select>
                <div class="modal-buttons">
                    <button type="button" class="btn-close" id="btn-cancel-change-status">Batal</button>
                    <button type="submit" class="btn-save">Simpan</button>
                </div>
            </form>
        </div>
    </div>


    <script>
        const appData = {
            loggedInGuru: {
                id: 1,
                nama: 'Ahmad Syukri',
                nip: '1234567890',
                jabatan: 'Guru Matematika',
                email: 'ahmad@example.com',
                gender: 'Laki-Laki',
                dob: '1985-05-10',
                nohp: '08123456789',
                alamat: 'Jl. Jend. Sudirman No. 45',
                photoUrl: 'https://i.pinimg.com/originals/56/23/a3/5623a3007d20657bdd96ff799e6fd814.jpg'
            },
            schedules: {
                'Senin': [
                    { id: 'senin_mat_xa', kelas: 'X A', mataPelajaran: 'Matematika Wajib', jamMulai: '08:00', jamSelesai: '09:30' },
                    { id: 'senin_bindo_xipa1', kelas: 'XI IPA 1', mataPelajaran: 'Bahasa Indonesia', jamMulai: '10:00', jamSelesai: '11:30' }
                ],
                'Selasa': [
                    { id: 'selasa_fis_xiipa2', kelas: 'XI IPA 2', mataPelajaran: 'Fisika', jamMulai: '09:00', jamSelesai: '10:30' }
                ]
            },
            simulatedStudentsData: {
                'X A': [
                    { nama: 'Dinda Amelia' },
                    { nama: 'Budi Santoso' },
                    { nama: 'Citra Dewi' },
                    { nama: 'Joni Iskandar' },
                    { nama: 'Putri Salsabila' }
                ],
                'XI IPA 1': [
                    { nama: 'Eko Prasetyo' },
                    { nama: 'Hendra Gunawan' }
                ],
                'XI IPA 2': [
                    { nama: 'Fani Lestari' },
                    { nama: 'Gita Permata' }
                ]
            },
            simulatedAttendanceData: [
                { id: 1, jadwalId: 'senin_mat_xa', muridNama: 'Dinda Amelia', status: 'Pending', type: 'Sakit', keterangan: 'Demam tinggi', waktuAbsen: '1 Agustus 2025, 07:45:00' },
                { id: 2, jadwalId: 'senin_mat_xa', muridNama: 'Budi Santoso', status: 'Hadir', type: 'Hadir', keterangan: '', waktuAbsen: '1 Agustus 2025, 07:50:00' },
                { id: 3, jadwalId: 'senin_mat_xa', muridNama: 'Citra Dewi', status: 'Pending', type: 'Izin', keterangan: 'Ada acara keluarga', waktuAbsen: '1 Agustus 2025, 07:55:00' },
                { id: 4, jadwalId: 'senin_mat_xa', muridNama: 'Joni Iskandar', status: 'Hadir', type: 'Hadir', keterangan: '', waktuAbsen: '1 Agustus 2025, 07:58:00' },
                { id: 5, jadwalId: 'senin_bindo_xipa1', muridNama: 'Eko Prasetyo', status: 'Hadir', type: 'Hadir', keterangan: '', waktuAbsen: '1 Agustus 2025, 09:50:00' },
                { id: 6, jadwalId: 'selasa_fis_xiipa2', muridNama: 'Fani Lestari', status: 'Pending', type: 'Izin', keterangan: 'Mengikuti lomba', waktuAbsen: '2 Agustus 2025, 08:30:00' }
            ]
        };

        // DOM Elements
        const sidebar = document.getElementById('sidebar');
        const header = document.getElementById('header');
        const mainContent = document.getElementById('mainContent');
        const pageTitle = document.getElementById('page-title');
        const profileBtn = document.getElementById('profile-btn');
        const logoutBtn = document.getElementById('logout-btn');

        const jadwalTab = document.getElementById('jadwal-tab');
        const absensiTab = document.getElementById('absensi-tab');

        const jadwalContent = document.getElementById('jadwal-content');
        const absensiContent = document.getElementById('absensi-content');

        const profileImg = document.getElementById('profile-img');
        const profileName = document.getElementById('profile-name');
        const profileTitle = document.getElementById('profile-title');
        const profileEmail = document.getElementById('profile-email');
        const welcomeName = document.getElementById('welcome-name');
        
        const scheduleContainer = document.getElementById('schedule-container');
        const classFilter = document.getElementById('class-filter');
        const attendanceRecordsContainer = document.getElementById('attendance-records-container');

        // Modal
        const guruViewModal = document.getElementById('guru-view-modal');
        const guruModal = document.getElementById('guru-modal');
        const guruForm = document.getElementById('guru-form');
        const btnCloseView = document.getElementById('btn-close-view');
        const btnEditProfileFromView = document.getElementById('btn-edit-profile-from-view');
        const btnCancel = document.getElementById('btn-cancel');
        const photoGuru = document.getElementById('photoGuru');
        const photoPreview = document.getElementById('photo-preview');
        
        // New Modal for Changing Status
        const changeStatusModal = document.getElementById('change-status-modal');
        const modalMuridNama = document.getElementById('modal-murid-nama');
        const newStatusSelect = document.getElementById('new-status');
        const changeStatusForm = document.getElementById('change-status-form');
        const btnCancelChangeStatus = document.getElementById('btn-cancel-change-status');
        
        let currentRecordToEdit = null;

        window.toggleSidebar = function() {
            sidebar.classList.toggle('collapsed');
            header.classList.toggle('shifted');
            mainContent.classList.toggle('shifted');
        }

        function switchContent(contentId) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(contentId).classList.add('active');

            document.querySelectorAll('.sidebar-menu a').forEach(link => {
                link.classList.remove('active');
            });

            let title = '';
            if (contentId === 'jadwal-content') {
                jadwalTab.classList.add('active');
                title = 'Jadwal Mengajar';
                displaySchedules();
            } else if (contentId === 'absensi-content') {
                absensiTab.classList.add('active');
                title = 'Rekap Absensi';
                populateClassFilter();
                displayAttendanceRecords();
            }
            pageTitle.textContent = title;
        }

        function updateProfileView(guru) {
            profileImg.src = guru.photoUrl;
            profileName.textContent = guru.nama;
            profileTitle.textContent = guru.jabatan;
            profileEmail.textContent = guru.email;
            welcomeName.textContent = `Pak ${guru.nama.split(' ')[0]}`;
        }
        
        function showProfileViewModal(guru) {
            document.getElementById('profile-view-img').src = guru.photoUrl;
            document.getElementById('profile-view-nip').textContent = guru.nip;
            document.getElementById('profile-view-nama').textContent = guru.nama;
            document.getElementById('profile-view-jabatan').textContent = guru.jabatan;
            document.getElementById('profile-view-email').textContent = guru.email;
            document.getElementById('profile-view-nohp').textContent = guru.nohp;
            document.getElementById('profile-view-gender').textContent = guru.gender;
            document.getElementById('profile-view-dob').textContent = guru.dob;
            document.getElementById('profile-view-alamat').textContent = guru.alamat;
            guruViewModal.style.display = 'flex';
        }

        function loadGuruDataToForm(guru) {
            document.getElementById('namaGuru').value = guru.nama;
            document.getElementById('nipGuru').value = guru.nip;
            document.getElementById('dobGuru').value = guru.dob;
            document.getElementById('nohpGuru').value = guru.nohp;
            document.getElementById('emailGuru').value = guru.email;
            document.getElementById('alamatGuru').value = guru.alamat;
            document.getElementById('passwordGuru').value = '';
            if (guru.gender === 'Laki-Laki') {
                document.getElementById('male').checked = true;
            } else {
                document.getElementById('female').checked = true;
            }
            photoPreview.style.backgroundImage = `url(${guru.photoUrl})`;
        }
        
        function displaySchedules() {
            scheduleContainer.innerHTML = '';
            const daysOrder = ['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu', 'Minggu'];
            
            daysOrder.forEach(day => {
                const daySchedules = appData.schedules[day];
                if (daySchedules && daySchedules.length > 0) {
                    const daySection = document.createElement('div');
                    daySection.innerHTML = `<h3>${day}</h3>`;
                    
                    const cardContainer = document.createElement('div');
                    cardContainer.classList.add('schedule-card-container');
                    
                    daySchedules.forEach(schedule => {
                        const scheduleCard = document.createElement('div');
                        scheduleCard.classList.add('schedule-card');
                        scheduleCard.setAttribute('data-schedule-id', schedule.id);
                        scheduleCard.innerHTML = `
                            <h4>${schedule.mataPelajaran}</h4>
                            <p>Kelas: ${schedule.kelas}</p>
                            <p class="time">${schedule.jamMulai} - ${schedule.jamSelesai}</p>
                        `;
                        scheduleCard.addEventListener('click', () => {
                            showAttendanceList(schedule.id, schedule.kelas, day);
                        });
                        cardContainer.appendChild(scheduleCard);
                    });
                    
                    daySection.appendChild(cardContainer);
                    scheduleContainer.appendChild(daySection);
                }
            });
        }
        
        function populateClassFilter() {
            classFilter.innerHTML = '<option value="">Pilih Kelas</option>';
            const uniqueClasses = new Set();
            Object.values(appData.schedules).forEach(daySchedules => {
                daySchedules.forEach(schedule => {
                    if (schedule.kelas && !uniqueClasses.has(schedule.kelas)) {
                        const option = document.createElement('option');
                        option.value = schedule.kelas;
                        option.textContent = schedule.kelas;
                        classFilter.appendChild(option);
                        uniqueClasses.add(schedule.kelas);
                    }
                });
            });

            classFilter.removeEventListener('change', displayAttendanceRecords);
            classFilter.addEventListener('change', displayAttendanceRecords);
        }
        
        function displayAttendanceRecords() {
            const selectedClass = classFilter.value;
            attendanceRecordsContainer.innerHTML = '';
            
            if (!selectedClass) {
                attendanceRecordsContainer.innerHTML = '<p>Pilih kelas untuk melihat rekap absensi.</p>';
                return;
            }

            const classSchedules = Object.values(appData.schedules).flat().filter(s => s.kelas === selectedClass);
            
            if (classSchedules.length === 0) {
                attendanceRecordsContainer.innerHTML = '<p>Tidak ada jadwal untuk kelas ini.</p>';
                return;
            }

            let recordsHtml = '';
            classSchedules.forEach(schedule => {
                const scheduleRecords = appData.simulatedAttendanceData.filter(r => r.jadwalId === schedule.id);
                recordsHtml += `
                    <div class="attendance-records-card" style="margin-bottom: 20px;">
                        <h4>${schedule.mataPelajaran} (${schedule.jamMulai} - ${schedule.jamSelesai})</h4>
                        <div style="border-top: 1px solid #ddd; margin-top: 10px; padding-top: 10px;">
                            ${scheduleRecords.map(record => `
                                <div class="attendance-list-item">
                                    <div class="murid-info">
                                        <strong>${record.muridNama}</strong>
                                        <p style="font-size: 0.8em; color: #777;">Keterangan: ${record.keterangan || '-'}</p>
                                    </div>
                                    <span class="status status-${record.status.replace(/\s/g, '_')}">${record.status}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            });

            attendanceRecordsContainer.innerHTML = recordsHtml;
        }

        function showAttendanceList(scheduleId, className, day) {
            const modal = document.getElementById('attendance-list-modal');
            const title = document.getElementById('attendance-list-modal-title');
            const listContainer = document.getElementById('attendance-list');
            
            title.textContent = `Absensi ${className} (${day})`;
            listContainer.innerHTML = '';
            
            const attendanceForSchedule = appData.simulatedAttendanceData.filter(a => a.jadwalId === scheduleId);
            
            if (attendanceForSchedule.length === 0) {
                listContainer.innerHTML = '<p>Belum ada data absensi untuk jadwal ini.</p>';
            } else {
                attendanceForSchedule.forEach(record => {
                    const listItem = document.createElement('div');
                    listItem.classList.add('attendance-list-item');
                    
                    let displayStatus = record.status;
                    if (record.status === 'Pending') {
                        displayStatus = `${record.type} (Pending)`;
                    }

                    const statusClass = `status-${record.status.replace(/\s/g, '_')}`;

                    listItem.innerHTML = `
                        <div class="murid-info">
                            <strong>${record.muridNama}</strong>
                            <p style="font-size: 0.8em; color: #777;">Keterangan: ${record.keterangan || '-'}</p>
                            <p style="font-size: 0.8em; color: #777;">Waktu Absen: ${record.waktuAbsen}</p>
                        </div>
                        <span class="status ${statusClass}">${displayStatus}</span>
                        <div class="actions">
                            <button class="confirm" title="Konfirmasi Absen"><i class="fas fa-check"></i></button>
                            <button class="reject" title="Tolak Absen"><i class="fas fa-times"></i></button>
                            <button class="cancel" title="Ubah menjadi Pending"><i class="fas fa-exclamation-circle"></i></button>
                        </div>
                    `;
                    
                    const confirmBtn = listItem.querySelector('.confirm');
                    const rejectBtn = listItem.querySelector('.reject');
                    const cancelBtn = listItem.querySelector('.cancel');
                    
                    confirmBtn.addEventListener('click', () => {
                        confirmAttendance(record);
                        updateAttendanceList(scheduleId, className, day);
                    });
                    
                    rejectBtn.addEventListener('click', () => {
                        rejectAttendance(record);
                        updateAttendanceList(scheduleId, className, day);
                    });
                    
                    cancelBtn.addEventListener('click', () => {
                        cancelAttendance(record);
                        updateAttendanceList(scheduleId, className, day);
                    });

                    listContainer.appendChild(listItem);
                });
            }
            
            modal.style.display = 'flex';
        }
        
        function confirmAttendance(record) {
            const index = appData.simulatedAttendanceData.findIndex(r => r.id === record.id);
            if (index !== -1) {
                // Mengubah status Pending menjadi status aslinya
                if(record.status === 'Pending') {
                    appData.simulatedAttendanceData[index].status = record.type;
                    alert(`Absen murid ${record.muridNama} dikonfirmasi menjadi ${record.type}.`);
                } else {
                    // Jika status sudah dikonfirmasi, tawarkan untuk mengubah status
                    showChangeStatusModal(record);
                }
            }
        }
        
        function rejectAttendance(record) {
            const index = appData.simulatedAttendanceData.findIndex(r => r.id === record.id);
            if (index !== -1) {
                appData.simulatedAttendanceData[index].status = 'Alpha';
                appData.simulatedAttendanceData[index].type = 'Alpha';
                alert(`Absen murid ${record.muridNama} ditolak, status diubah menjadi Alpha.`);
            }
        }

        function cancelAttendance(record) {
             const index = appData.simulatedAttendanceData.findIndex(r => r.id === record.id);
             if (index !== -1) {
                appData.simulatedAttendanceData[index].status = 'Pending';
                alert(`Status murid ${record.muridNama} diubah kembali menjadi Pending.`);
            }
        }
        
        function showChangeStatusModal(record) {
            currentRecordToEdit = record;
            modalMuridNama.textContent = record.muridNama;
            newStatusSelect.value = record.status;
            changeStatusModal.style.display = 'flex';
        }

        function updateAttendanceList(scheduleId, className, day) {
            showAttendanceList(scheduleId, className, day);
            displayAttendanceRecords();
        }

        changeStatusForm.addEventListener('submit', (e) => {
            e.preventDefault();
            if (currentRecordToEdit) {
                const newStatus = newStatusSelect.value;
                const index = appData.simulatedAttendanceData.findIndex(r => r.id === currentRecordToEdit.id);
                if (index !== -1) {
                    appData.simulatedAttendanceData[index].status = newStatus;
                    appData.simulatedAttendanceData[index].type = newStatus; // Update type juga
                    alert(`Status absensi ${currentRecordToEdit.muridNama} berhasil diubah menjadi ${newStatus}.`);
                    changeStatusModal.style.display = 'none';
                    updateAttendanceList(currentRecordToEdit.jadwalId, 'nama_kelas_placeholder', 'hari_placeholder');
                }
            }
        });

        btnCancelChangeStatus.addEventListener('click', () => {
            changeStatusModal.style.display = 'none';
        });

        profileBtn.addEventListener('click', () => {
            showProfileViewModal(appData.loggedInGuru);
        });

        btnEditProfileFromView.addEventListener('click', () => {
            guruViewModal.style.display = 'none';
            loadGuruDataToForm(appData.loggedInGuru);
            guruModal.style.display = 'flex';
        });

        btnCloseView.addEventListener('click', () => {
            guruViewModal.style.display = 'none';
        });
        
        document.getElementById('btn-close-absensi').addEventListener('click', () => {
            document.getElementById('attendance-list-modal').style.display = 'none';
        });

        logoutBtn.addEventListener('click', () => {
            alert('Anda telah logout!');
        });

        btnCancel.addEventListener('click', () => {
            guruModal.style.display = 'none';
        });

        photoGuru.addEventListener('change', function() {
            const file = this.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    photoPreview.style.backgroundImage = `url(${e.target.result})`;
                }
                reader.readAsDataURL(file);
            }
        });

        guruForm.addEventListener('submit', (e) => {
            e.preventDefault();

            const nama = document.getElementById('namaGuru').value;
            const gender = document.querySelector('input[name="gender"]:checked').value;
            const dob = document.getElementById('dobGuru').value;
            const nohp = document.getElementById('nohpGuru').value;
            const email = document.getElementById('emailGuru').value;
            const password = document.getElementById('passwordGuru').value;
            const alamat = document.getElementById('alamatGuru').value;
            const photoFile = photoGuru.files[0];

            appData.loggedInGuru.nama = nama;
            appData.loggedInGuru.gender = gender;
            appData.loggedInGuru.dob = dob;
            appData.loggedInGuru.nohp = nohp;
            appData.loggedInGuru.email = email;
            appData.loggedInGuru.alamat = alamat;
            if (password) { console.log('Password diperbarui'); }

            if (photoFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    appData.loggedInGuru.photoUrl = e.target.result;
                    updateProfileView(appData.loggedInGuru);
                    alert('Profil berhasil diubah!');
                    guruModal.style.display = 'none';
                };
                reader.readAsDataURL(photoFile);
            } else {
                updateProfileView(appData.loggedInGuru);
                alert('Profil berhasil diubah!');
                guruModal.style.display = 'none';
            }
        });

        window.onclick = function(event) {
            if (event.target == guruModal || event.target == guruViewModal || event.target.id === 'attendance-list-modal') {
                event.target.style.display = "none";
            }
            if (event.target == changeStatusModal) {
                 changeStatusModal.style.display = 'none';
            }
        }

        jadwalTab.addEventListener('click', (e) => {
            e.preventDefault();
            switchContent('jadwal-content');
        });

        absensiTab.addEventListener('click', (e) => {
            e.preventDefault();
            switchContent('absensi-content');
        });

        document.addEventListener('DOMContentLoaded', () => {
            updateProfileView(appData.loggedInGuru);
            switchContent('jadwal-content');
        });
    </script>
</body>
</html>